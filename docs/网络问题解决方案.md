# Docker 网络问题解决方案

## 问题：所有镜像源都无法连接

当你遇到以下错误时：
- `dockerproxy.com:443: connectex: A connection attempt failed`
- `403 Forbidden` 从多个镜像源
- `no such host` DNS 解析失败

说明你的网络环境可能：
1. 无法访问国外镜像源（Docker Hub、镜像加速器）
2. 防火墙/代理阻止了连接
3. DNS 解析问题

## 解决方案

### 方案 1：使用官方 Docker Hub（如果网络允许）

**清除镜像加速器配置：**

1. 运行：`清除镜像加速器使用官方源.bat`
2. 或者手动在 Docker Desktop 设置中删除 `registry-mirrors` 配置
3. 重启 Docker Desktop
4. 重新运行启动脚本

### 方案 2：配置代理（如果你有可用的代理）

**在 Docker Desktop 中配置代理：**

1. 打开 Docker Desktop
2. 点击设置图标
3. 选择 "Resources" -> "Proxies"
4. 配置 HTTP/HTTPS 代理
5. 保存并重启

### 方案 3：使用 VPN

如果你有 VPN：
1. 连接 VPN
2. 重新运行启动脚本

### 方案 4：手动下载并导入镜像（最可靠）

**步骤：**

1. **在能访问 Docker Hub 的环境中下载镜像：**
   ```bash
   docker pull postgres:15-alpine
   docker pull redis:7-alpine
   
   # 保存为 tar 文件
   docker save postgres:15-alpine -o postgres-15-alpine.tar
   docker save redis:7-alpine -o redis-7-alpine.tar
   ```

2. **将 tar 文件复制到当前环境**

3. **在当前环境中导入镜像：**
   ```bash
   docker load -i postgres-15-alpine.tar
   docker load -i redis-7-alpine.tar
   ```

4. **验证镜像：**
   ```bash
   docker images | findstr "postgres redis"
   ```

5. **运行启动脚本：**
   ```
   启动应用-配合phpStudy.bat
   ```

### 方案 5：使用其他镜像仓库（如果有）

如果有可访问的其他镜像仓库：
1. 将镜像推送到可访问的仓库
2. 修改 `docker-compose.yml` 中的镜像地址
3. 重新运行启动脚本

## 快速诊断

**检查网络连接：**

```powershell
# 测试 Docker Hub 连接
Test-NetConnection -ComputerName registry-1.docker.io -Port 443

# 测试镜像加速器连接
Test-NetConnection -ComputerName dockerproxy.com -Port 443
```

**检查 DNS 解析：**

```powershell
# 测试 DNS
Resolve-DnsName dockerproxy.com
Resolve-DnsName registry-1.docker.io
```

## 推荐方案

根据你的情况选择：

1. **如果有稳定的代理/VPN**：使用方案 2 或 3
2. **如果没有代理但可以访问其他环境**：使用方案 4（手动下载）
3. **如果网络完全隔离**：考虑使用内网镜像仓库或其他方式

## 当前状态

- 所有镜像加速器都无法连接
- 需要清除镜像加速器配置或使用其他方案

建议先尝试方案 1（清除镜像加速器，使用官方源），如果仍然失败，再尝试其他方案。
